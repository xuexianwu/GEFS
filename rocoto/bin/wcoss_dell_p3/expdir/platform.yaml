accounting:
  cpu_project: GEN-T2O
  ecflow_header: envir-p3.h
  ecflow_machine: venus
  exclusive_partition: !calc 'doc.platform.partitions.default_exclusive'
  hpss_project: ensemble
  service_partition: !calc 'doc.platform.partitions.default_service'
  shared_partition: !calc 'doc.platform.partitions.default_shared'
  user_email: none
partition_common:
  Evaluate: false
  default_resources: &id001 {}
  resources: &id002 !Immediate
  - !MergeMapping
    - !calc 'doc.default_resources'
    - !calc 'doc.platform.default_resources'
    - !calc 'doc.case.get(''resources'',{})'
    - !calc 'doc.get(''user_resources'',{})'
    - !calc 'doc.resources_sum'
platform: !Platform
  BASE_CPLIC: /gpfs/dell2/emc/modeling/noscrub/Walter.Kolczynski/global-workflow/IC
  BASE_GIT: /gpfs/dell2/emc/modeling/noscrub/emc.glopara/git
  BASE_SVN: /gpfs/dell2/emc/modeling/noscrub/emc.glopara/svn
  CHGRP_RSTPROD_COMMAND: chgrp rstprod
  COMROOT: !FirstTrue
  - do: !expand '{doc.user_places.COMROOT}'
    when: !calc 'doc.user_places.FIX_SCRUB'
  - otherwise: !expand '{doc.platform.least_used_temp}/{tools.env(''USER'')}'
  DATAROOT: !FirstTrue
  - do: !expand '{doc.user_places.DATAROOT}'
    when: !calc 'doc.user_places.FIX_SCRUB'
  - otherwise: !expand '{doc.platform.least_used_temp}/{tools.env(''USER'')}'
  DMPDIR: !FirstTrue
  - do: /gpfs/dell3/emc/global/dump
    when: !calc 'tools.isdir(do)'
  - do: /gpfs/hps3/emc/global/dump
    when: !calc 'tools.isdir(do)'
  - otherwise: !error 'Cannot find globaldump directory.'
  EXPROOT: !expand '{doc.user_places.EXPROOT}'
  Evaluate: true
  NWPROD: /gpfs/dell1/nco/ops/nwprod
  RTMFIX: $CRTM_FIX
  config_base_extras: "if [ -d /gpfs/tp1 ]; then\n    export SITE=\"MARS\"\nelif [\
    \ -d /gpfs/gp1 ]; then\n    export SITE=\"VENUS\"\nfi\n"
  default_resources: &id008 {}
  detect: !calc '( tools.isdir("/usrx/local") and tools.isdir("/gpfs") )'
  ecflow_module: ecflow/4.7.1
  four_cycle_mode_modules: 'module load ips/$ips_ver

    module load impi/$impi_ver

    module load EnvVars/$EnvVars_ver


    module load g2tmpl/$g2tmpl_ver

    module load crtm/$crtm_ver

    module load ESMF/$ESMF_ver

    module load dev/util_shared/$util_shared_ver  # NOTE: remove dev/ after util_shared
    upgrade


    module unload grib_util

    module load dev/grib_util/$grib_util_ver  # NOTE: remove dev/ after grib_util
    upgrade


    module load NCO/$NCO_ver

    module load HDF5-serial/$HDF5_serial_ver

    module load NetCDF/$NetCDF_ver

    module load CFP/$CFP_ver

    export USE_CFP=YES


    module use /gpfs/dell1/nco/ops/nwpara/modulefiles/

    module load gempak/$gempak_ver


    module load bufr_dumplist/$bufr_dumplist_ver

    module load dumpjb/$dumpjb_ver

    module load NCL/$NCL_ver

    '
  least_used_ptmp: /gpfs/dell1/ptmp
  least_used_stmp: /gpfs/dell1/stmp
  long_term_temp: !expand '{least_used_ptmp}/{tools.env(''USER'')}'
  metasched_more: !expand '{metasched.defvar(doc.schedvar.exclusive_queue, doc.accounting.exclusive_partition.exclusive_queue)}

    {metasched.defvar(doc.schedvar.shared_queue, doc.accounting.shared_partition.shared_queue)}

    {metasched.defvar(doc.schedvar.service_queue, doc.accounting.service_partition.service_queue)}

    {metasched.defvar(doc.schedvar.cpu_project, doc.accounting.cpu_project)}

    '
  mmlsquota: /usr/lpp/mmfs/bin/mmlsquota
  name: WCOSS_DELL_P3
  ncks: /usrx/local/prod/packages/ips/18.0.1/nco/4.7.0/bin/ncks
  partition_common:
    Evaluate: false
    default_resources: *id001
    exclusive_accounting_ref: &id003
      project: !calc 'metasched.varref(doc.schedvar.cpu_project)'
      queue: !calc 'metasched.varref(doc.schedvar.exclusive_queue)'
    exclusive_queue: &id004 !FirstTrue
    - do: dev2
      when: !calc '( tools.can_write("/gpfs/hps2/ptmp") )'
    - otherwise: devonprod
    nodes: !calc 'tools.node_tool_for(scheduler_settings.node_type, scheduler_settings)

      '
    parallelism: !calc 'tools.get_parallelism(scheduler_settings.parallelism_name,
      scheduler_settings)

      '
    resources: *id002
    scheduler: !calc 'tools.get_scheduler(scheduler_settings.scheduler_name, scheduler_settings)

      '
    service_accounting_ref: &id005
      project: !calc 'metasched.varref(doc.schedvar.cpu_project)'
      queue: !calc 'metasched.varref(doc.schedvar.service_queue)'
    service_queue: dev2_transfer
    shared_accounting_ref: &id006
      project: !calc 'metasched.varref(doc.schedvar.cpu_project)'
      queue: !calc 'metasched.varref(doc.schedvar.shared_queue)'
    shared_queue: &id007 !FirstTrue
    - do: dev2_shared
      when: !calc '( tools.can_write("/gpfs/hps2/ptmp") )'
    - otherwise: devonprod_shared
  partitions:
    Evaluate: false
    default_exclusive: !calc 'doc.platform.partitions.exclusive_p3'
    default_service: !calc 'doc.platform.partitions.shared_p3'
    default_shared: !calc 'doc.platform.partitions.shared_p3'
    exclusive_p3:
      Evaluate: false
      default_resources: *id001
      exclusive_accounting_ref: *id003
      exclusive_queue: *id004
      nodes: !calc 'tools.node_tool_for(scheduler_settings.node_type, scheduler_settings)

        '
      parallelism: !calc 'tools.get_parallelism(scheduler_settings.parallelism_name,
        scheduler_settings)

        '
      resources: *id002
      scheduler: !calc 'tools.get_scheduler(scheduler_settings.scheduler_name, scheduler_settings)

        '
      scheduler_settings:
        hyperthreading_allowed: true
        indent_text: '  '
        logical_cpus_per_core: 2
        memory_per_node: !calc '(120*1024)'
        node_type: generic
        parallelism_name: HydraIMPI
        physical_cores_per_node: 40
        scheduler_name: LSF
        specify_memory: false
        use_task_geometry: false
      service_accounting_ref: *id005
      service_queue: dev2_transfer
      shared_accounting_ref: *id006
      shared_queue: *id007
      specification: exclusive_p3
    shared_p3:
      Evaluate: false
      default_resources: *id001
      exclusive_accounting_ref: *id003
      exclusive_queue: *id004
      nodes: !calc 'tools.node_tool_for(scheduler_settings.node_type, scheduler_settings)

        '
      parallelism: !calc 'tools.get_parallelism(scheduler_settings.parallelism_name,
        scheduler_settings)

        '
      resources: *id002
      scheduler: !calc 'tools.get_scheduler(scheduler_settings.scheduler_name, scheduler_settings)

        '
      scheduler_settings:
        hyperthreading_allowed: true
        indent_text: '  '
        logical_cpus_per_core: 2
        memory_per_node: !calc '(120*1024)'
        node_type: generic
        parallelism_name: HydraIMPI
        physical_cores_per_node: 1
        scheduler_name: LSF
        specify_memory: true
        use_task_geometry: false
      service_accounting_ref: *id005
      service_queue: dev2_transfer
      shared_accounting_ref: *id006
      shared_queue: *id007
      specification: shared_p3
  prod_util_module: prod_util/1.1.0
  public_release_ics: /gpfs/hps3/emc/global/noscrub/emc.glopara/FV3GFS_V1_RELEASE/ICs
  short_term_temp: !expand '{least_used_stmp}/{tools.env(''USER'')}'
platform_common:
  Evaluate: false
  default_resources: *id008
user_places:
  COMROOT: /gpfs/dell6/emc/modeling/noscrub/Bing.Fu/p7cens/com
  DATAROOT: /gpfs/dell6/emc/modeling/noscrub/Bing.Fu/p7cens/stmp
  EXPROOT: /gpfs/dell6/emc/modeling/noscrub/Bing.Fu/p7cens
  FIX_SCRUB: true
