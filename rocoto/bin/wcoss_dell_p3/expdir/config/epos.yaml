# This file is used to generate config.epos, which would be used to
# control the ENKF post-processing.  The scripts and code for the ENKF
# are not provided in this release, so this config file is ignored.

config_epos:
  filename: config.epos
  content: !expand |
    #!/bin/ksh -x
    
    # This file is automatically generated from the YAML-based system
    # in ecf/ecfutils/.  Any changes will be overwritten if
    # setup_case.sh is rerun.
    
    ########## config.epos ##########
    # Ensemble post processing specific
    
    echo "BEGIN: config.epos"

    export npe_epos="{doc.partition_common.resources.run_epos[0].mpi_ranks}"
    export npe_node_epos="{doc.partition_common.resources.run_epos[0].max_ppn}"
    export nth_epos="{doc.partition_common.resources.run_epos[0].OMP_NUM_THREADS}"
    if [[ "$machine" = "WCOSS_DELL_P3" ]]; then
        export nth_epos=7
    fi
    if [[ "$machine" == "WCOSS_C" ]]; then
        export memory_epos="254M"
    elif [[ "$machine" == "GAEA" ]]; then
        export memory_epos="254"
    fi
    
    export ENKFPOSTSH="$HOMEgsi/scripts/exglobal_enkf_post_fv3gfs.sh.ecf"

    # No. of concurrent epos jobs [1 implies sequential]
    export NEPOSGRP={doc.data_assimilation.NEPOSGRP}
    if [ $l4densvar = ".false." ]; then
        export NEPOSGRP=3
    fi
    
    echo "END: config.epos"
    
